## BGP
- セッション確立に必要なTCPポートは179
- BGPの優先順位の設定
    - ローカルプリファレンスのBGPコミュニティタグを使用する
        - 最も高い値が優先される
    - AS_PATHは経路選択に使用する値
- BFD（Bidirectional Forwarding Detection：双方向転送検出）
    - 2台の隣接するルータ間の転送パスの生存状況を調べて、高速に障害を検知してルーティングプロトコルに通知する機能
        - 隣接するルータとの間にL2スイッチなどが存在し、リンクステータスが伝わらない障害が発生した場合に効果的な機能
## NLB
- NLBのクロスゾーン負荷分散
    - 無効にすることでトラフィックを同一AZ内のターゲットに優先的に送信する
    - 有効な場合、すべてのAZの登録済みターゲットにトラフィックを分散する
- NLBはアプリケーションベースのスティッキーセッションを提供していない
## AWS Direct Connect
- 基礎知識
    - オンプレミスとAWSを専用線で接続する例
        1. オンプレミス
            1. ルーター
        1. Direct Connectロケーション
            1. ユーザールーター
                - ユーザーが用意するか、もしくはパートナー企業に用意してもらう
            1. Connection
                - Direct Connectロケーション内でユーザールーターとAWSルーターを繋ぐ線
                    - AWS側が管理
            1. AWSルーター
        1. AWS
            1. VGW（Virtual Private Gateway）
                - VPC毎に作成
    - オンプレミスとAWSの複数のVPCを専用線で接続する例
        - 例1
            1. オンプレミス
                1. ルーター
            1. Direct Connectロケーション
                1. ユーザールーター
                1. Connection
                1. AWSルーター
            1. AWS
                1. DXGW（Direct Connect Gateway）
                    - 複数のVPCの前に設置する（1対多の関係となる）
                        - 他リージョンのVPCとも接続可能
                        - 接続可能なVPCは最大20個
                    - VIF1本で複数のVPCと接続可能
                1. VGW（Virtual Private Gateway）
        - 例2
            1. オンプレミス
                1. ルーター
            1. Direct Connectロケーション
                1. ユーザールーター
                1. Connection
                1. AWSルーター
            1. AWS
                1. TGW（Transit Gateway）
                    - 21個以上のVPCを接続するか、またはVPC間で接続をする場合、TGWを使用する
                        - VPC間での相互接続が可能であるため、IPセグメントの重複に注意
                    - VIFはトランジットVIFにする必要がある
                1. VGW（Virtual Private Gateway）
    - VIF（Virtual Private InterFace）
        - Connection（物理的な接続線）の上に仮想的な専用線を作成するイメージ
        - 種類
            - プライベートVIF
                - VPCへプライベートIPで接続するための線
                - VIFとVPCは1対1の関係
            - パブリックVIF
                - AWSへパブリックIPで接続するための線
            - トランジットVIF
- AWS Direct Connect SiteLink
    - 異なるAWSリージョン間やオンプレミス間でのデータ転送を最適化し、接続の冗長性と信頼性を向上させることができる
    - 既存のトランジットVIFで有効にすることにより、新たな設備投資や追加のゲートウェイ構築を行うことなく、即時に高い接続信頼性を実現できる
## Transit Gateway
- Transit Gatewayピアリングアタッチメント
    - 異なるアカウント間のTransit Gatewayを直接接続し、ルーティングを簡単に設定できる
    - 既存のCIDRブロックやASNに影響を与えずに接続を確立できる
- Transit Gatewayアプライアンスモード
    - ステートフルファイアウォールアプライアンスを経由する際に必要なトラフィックの検査とルーティングを可能にする
    - 行きの通信と帰りの通信の経路を対称とする
        - 非対称な通信とは行きと帰りの通信の経路が違う通信のこと
- AWS RAM（Resource Access Manager）を使用してAWS Transit Gatewayを共有する方法
    - 例：接続アカウントにあるTransit Gatawayを本番アカウントに共有する
        1. 接続アカウントのAWS RAMにてTransit Gatewayのリソース共有を作成する
            - 本番アカウントIDを指定して、外部アカウントを許可する機能を有効にする
        1. 本番アカウントでリソース共有を受け入れて、VPCサブネットへのアタッチメントを作成する
        1. 接続アカウントでアタッチメントを受け入れてルートテーブルを関連づける
## AWS Site-to-Site VPN
- デッドピア検出（DPD）タイムアウトが発生した後に実行するアクション
    - Clear
        - DPDタイムアウトが発生した時にIKEセッションを終了する
    - None
        - DPDタイムアウトが発生しても何もアクションを実行しない
    - Restart
        - DPdタイムアウトが発生した時にIKEセッションを再起動する
## Route 53
- Route53でのDNSSEC署名の設定
    1. Route53においてDNSSECを有効にする
    1. AWS KMSを用いてキー署名キー（KSK）を作成する
    1. 親ゾーンに委任署名者（DS）レコードを追加する
        - サブドメインと親ドメインの間に信頼チェーンが形成される
- Route53のヘルスチェック
    - パブリックIPアドレスやパブリックに公開されたホスト名を前提としている
        - プライベートIPアドレスには対応していない
            - 代替手段としてCloudWatchを使用して監視する方法がある
## その他
- AWS Cloud WAN
    - VPC、VPN、SD-WAN（Transit Gateway Connect）をグローバルに接続でき、シンプルかつ管理しやすい
    - コアネットワークポリシーを更新し、セグメント共有を設定することにより、セグメント間のトラフィックフローが可能になる
- MACsecキー
    - オンプレミスルーターとDirectConnectロケーションの接続ポート間のMACsec接続を確立する事前共有キー
        - キーはAWSに提供し、デバイスでプロビジョニングしたCKN/CAKペアを塩湯して、接続の最後にデバイスによって生成される
            - CKN：接続キー名
            - CAK：接続関連付けキー
    - AWS KMSのカスタマーマネージドキーを使用してDirectConnectに関連づけられたキーを更新する
- AWS Network Firewallのデプロイモデル
    - 分散型
        - 個々のVPCにデプロイするモデル
    - 集約型
        - East-West（VPCからVPC）やNorth-South（インターネットやオンプレミスへの通信）のトラフィックを集約する検査用VPCにデプロイするモデル
    - 複合型
        - 上記モデルの組み合わせ。例として、インターネットからVPC内への通信はここのVPCにデプロイしたNetwork Firewallで検査、VPC同士の通信は検査用VPCにデプロイしたNetwork Firewallで検査するようなモデル
- VPC Reachability Analyzer
    - VPC内の2つのエンドポイント間、または複数のVPC間で、通信の到達性に関する問題を解決することが可能なネットワーク診断ツール
- AWS Network Manager Route Analyzer
    - ルートの視覚化と分析に役立ち、Transit Gateway間の通信問題を診断するのに適しているツール
        - VPCのルートテーブルの分析には適していない
- AWSクライアントVPNエンドポイントの分割トンネル
    - ClientVPNエンドポイントルートテーブルからのルートと一致するネットワークへの送信先を持つトラフィックだけがClientVPNトンネル経由でルーティングされ、それ以外のリモートユーザーのインターネットトラフィックはAWS ClientVPNを経由しなくなる
- Amazon VPC IP Address Manager（IPAM）
    - IPアドレスの使用状況を組織的に監視し管理するサービス
    - トップレベルプールと各VPCプール、さらにはサブネットプールを作成することで、VPC内のリソース全体のIPアドレス使用量に対して非常に詳細にモニタリング可能になる
    - 自動インポートオプションを有効にすることで、新しく作成されたVPCやサブネットも自動的に監視対象になる
- ジャンボフレーム（9001MTU）
    - パケットあたりのペイロードサイズを拡張し、パケットオーバーヘッド以外のパケットの割合を高めることによって、1500バイトを超えるデータを送信できる。同じ量の使用可能なデータを少ないパケットで送信することができる。
    - 次の場合はトラフィックのMTUは最大1500に制限される
        - インターネットゲートウェイ経由のトラフィック
        - リージョン間VPCピアリング接続経由のトラフィック
        - VPN接続経由のトラフィック
        - EC２-Classic用の特定のAWSリージョン外部にあるトラフィック
- Gateway Load Balancer
    - セキュリティアプライアンスなどのサードパーティー仮想アプライアンスを簡単にデプロイ、スケーリング、管理できる